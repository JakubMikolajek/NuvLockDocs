<!doctype html>
<html lang="pl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>NuvLock Swagger</title>

    <script src="./config.js"></script>

    <script>
      async function sha256hex(str) {
        const enc = new TextEncoder();
        const digest = await crypto.subtle.digest('SHA-256', enc.encode(str));
        return Array.from(new Uint8Array(digest)).map(b => b.toString(16).padStart(2, '0')).join('');
      }

      (async () => {
        const HASH = window.SWAGGER_PW_HASH || '';
        if (!HASH) {
          document.body.innerHTML = '<h2>Brak konfiguracji. Skontaktuj się z administratorem.</h2>';
          return;
        }

        if (sessionStorage.getItem('swagger_auth') !== '1') {
          const pwd = prompt('Wprowadź hasło dostępu do dokumentacji:');
          if (!pwd) {
            document.body.innerHTML = '<h2>Dostęp anulowany.</h2>';
            return;
          }
          const h = await sha256hex(pwd);
          if (h !== HASH) {
            document.body.innerHTML = '<h2>Nieprawidłowe hasło.</h2>';
            return;
          }
          sessionStorage.setItem('swagger_auth', '1');
        }

        document.body.innerHTML = '<div id="swagger-ui"></div>';
        const script = document.createElement('script');
        script.src = 'https://unpkg.com/swagger-ui-dist/swagger-ui-bundle.js';
        script.onload = () => {
          SwaggerUIBundle({
            url: './docs.yaml',
            dom_id: '#swagger-ui',
            presets: [SwaggerUIBundle.presets.apis],
          });
        };
        document.head.appendChild(script);
      })();
    </script>
</head>
<body>
<!-- zawartość generowana dynamicznie -->
</body>
</html>
